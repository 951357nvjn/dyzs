local Services = setmetatable({}, {
    __index = function(self, serviceName)
        return game:GetService(serviceName)
    end,
    __call = function(self, serviceName)
        return game:GetService(serviceName)
    end
})

local UDim_new = UDim.new
local UDim2_new = UDim2.new
local Color3_fromRGB = Color3.fromRGB
local Instance_new = Instance.new
local noop = function() end

local Mouse = Services.Players.LocalPlayer:GetMouse()

getgenv().library = {
    flags = {
        GetState = function(self, flagName)
            return library.flags[flagName].State
        end
    },
    modules = {},
    currentTab = nil
}

function library:UpdateToggle(flagName, newState)
    newState = newState or library.flags:GetState(flagName)
    if newState == library.flags:GetState(flagName) then
        return
    end
    library.flags[flagName]:SetState(newState)
end

local Utils = {}

function Utils:Tween(properties, instance, duration, easingStyle, easingDirection)
    return Services.TweenService:Create(
        instance,
        TweenInfo.new(duration or 0.25, Enum.EasingStyle[easingStyle or "Linear"], Enum.EasingDirection[easingDirection or "InOut"]),
        properties
    )
end

function Utils:SwitchTab(newTab)
    local currentTab = library.currentTab
    if currentTab == newTab then
        return
    end
    library.currentTab = newTab
    Utils:Tween({Transparency = 1}, currentTab[2].Glow):Play()
    Utils:Tween({Transparency = 0}, newTab[2].Glow):Play()
    currentTab[1].Visible = false
    newTab[1].Visible = true
end

-- GUI Creation
local ScreenGui = Instance_new("ScreenGui")
local MainFrame = Instance_new("Frame")
local MainCorner = Instance_new("UICorner")
local TitleLabel = Instance_new("TextLabel")
local TitleCorner = Instance_new("UICorner")
local Sidebar = Instance_new("Frame")
local SidebarCorner = Instance_new("UICorner")
local TabButtonsScroller = Instance_new("ScrollingFrame")
local TabButtonsLayout = Instance_new("UIListLayout")
local TabButtonsPadding = Instance_new("UIPadding")
local TabHolder = Instance_new("Frame")
local TabHolderCorner = Instance_new("UICorner")

local function MakeDraggable(dragElement, inputElement)
    if not inputElement then
        inputElement = dragElement
    end
    local dragging = false
    local dragStartPos
    local initialPosition
    local currentDragInput

    local function update(input)
        local delta = input.Position - dragStartPos
        dragElement.Position = UDim2_new(initialPosition.X.Scale, initialPosition.X.Offset + delta.X, initialPosition.Y.Scale, initialPosition.Y.Offset + delta.Y)
    end

    inputElement.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStartPos = input.Position
            initialPosition = dragElement.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    dragElement.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            currentDragInput = input
        end
    end)

    Services.UserInputService.InputChanged:Connect(function(input)
        if input == currentDragInput and dragging then
            update(input)
        end
    end)
end

syn.protect_gui(ScreenGui)

ScreenGui.Name = Services.HttpService:GenerateGUID(true)
ScreenGui.Parent = Services.CoreGui

MainFrame.Name = "Main"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3_fromRGB(52, 62, 72)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2_new(0.5, 0, 0.5, 0)
MainFrame.Size = UDim2_new(0, 448, 0, 280)
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)

MainCorner.CornerRadius = UDim_new(0, 6)
MainCorner.Name = "MainCorner"
MainCorner.Parent = MainFrame

TitleLabel.Parent = MainFrame
TitleLabel.BackgroundColor3 = Color3_fromRGB(58, 69, 80)
TitleLabel.BorderSizePixel = 0
TitleLabel.Position = UDim2_new(0, 6, 0, 6)
TitleLabel.Size = UDim2_new(0, 436, 0, 24)
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.Text = "  Woof Leak"
TitleLabel.TextColor3 = Color3_fromRGB(255, 255, 255)
TitleLabel.TextSize = 14
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left

TitleCorner.CornerRadius = UDim_new(0, 6)
TitleCorner.Name = "TextLabelCorner"
TitleCorner.Parent = TitleLabel

Sidebar.Name = "Sidebar"
Sidebar.Parent = MainFrame
Sidebar.BackgroundColor3 = Color3_fromRGB(58, 69, 80)
Sidebar.BorderSizePixel = 0
Sidebar.Position = UDim2_new(0, 6, 0, 36)
Sidebar.Size = UDim2_new(0, 106, 0, 238)

SidebarCorner.CornerRadius = UDim_new(0, 6)
SidebarCorner.Name = "SidebarCorner"
SidebarCorner.Parent = Sidebar

TabButtonsScroller.Name = "TabButtons"
TabButtonsScroller.Parent = Sidebar
TabButtonsScroller.Active = true
TabButtonsScroller.BackgroundColor3 = Color3_fromRGB(255, 255, 255)
TabButtonsScroller.BackgroundTransparency = 1
TabButtonsScroller.BorderSizePixel = 0
TabButtonsScroller.Size = UDim2_new(0, 106, 0, 238)
TabButtonsScroller.ScrollBarThickness = 0

TabButtonsLayout.Parent = TabButtonsScroller
TabButtonsLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
TabButtonsLayout.SortOrder = Enum.SortOrder.LayoutOrder
TabButtonsLayout.Padding = UDim_new(0, 5)

TabButtonsPadding.Parent = TabButtonsScroller
TabButtonsPadding.PaddingTop = UDim_new(0, 6)

TabHolder.Name = "TabHolder"
TabHolder.Parent = MainFrame
TabHolder.BackgroundColor3 = Color3_fromRGB(58, 69, 80)
TabHolder.BorderSizePixel = 0
TabHolder.Position = UDim2_new(0, 118, 0, 36)
TabHolder.Size = UDim2_new(0, 324, 0, 238)

TabHolderCorner.CornerRadius = UDim_new(0, 6)
TabHolderCorner.Name = "TabHolderCorner"
TabHolderCorner.Parent = TabHolder

TabButtonsLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    TabButtonsScroller.CanvasSize = UDim2_new(0, 0, 0, TabButtonsLayout.AbsoluteContentSize.Y + 12)
end)

MakeDraggable(MainFrame, TitleLabel)

function library:CreateTab(tabName)
    local tabButton = Instance_new("TextButton")
    local tabButtonCorner = Instance_new("UICorner")
    local glow = Instance_new("Frame")
    local glowCorner = Instance_new("UICorner")
    local glowGradient = Instance_new("UIGradient")
    local tabFrame = Instance_new("ScrollingFrame")
    local tabPadding = Instance_new("UIPadding")
    local tabLayout = Instance_new("UIListLayout")

    tabButton.Name = "TabButton"
    tabButton.Parent = TabButtonsScroller
    tabButton.BackgroundColor3 = Color3_fromRGB(52, 62, 72)
    tabButton.BorderSizePixel = 0
    tabButton.Size = UDim2_new(0, 94, 0, 28)
    tabButton.AutoButtonColor = false
    tabButton.Font = Enum.Font.GothamSemibold
    tabButton.Text = tabName
    tabButton.TextColor3 = Color3_fromRGB(255, 255, 255)
    tabButton.TextSize = 14

    tabButtonCorner.CornerRadius = UDim_new(0, 6)
    tabButtonCorner.Name = "TabButtonCorner"
    tabButtonCorner.Parent = tabButton

    glow.Name = "Glow"
    glow.Parent = tabButton
    glow.BackgroundColor3 = Color3_fromRGB(255, 255, 255)
    glow.BorderSizePixel = 0
    glow.Position = UDim2_new(0, 0, 0.928571463, 0)
    glow.Size = UDim2_new(0, 94, 0, 2)
    glow.Transparency = 1

    glowCorner.CornerRadius = UDim_new(0, 6)
    glowCorner.Name = "GlowCorner"
    glowCorner.Parent = glow

    glowGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0.00, Color3_fromRGB(52, 62, 72)),
        ColorSequenceKeypoint.new(0.50, Color3_fromRGB(255, 255, 255)),
        ColorSequenceKeypoint.new(1.00, Color3_fromRGB(52, 62, 72))
    })
    glowGradient.Name = "GlowGradient"
    glowGradient.Parent = glow

    tabFrame.Name = "Tab"
    tabFrame.Parent = TabHolder
    tabFrame.Active = true
    tabFrame.BackgroundColor3 = Color3_fromRGB(255, 255, 255)
    tabFrame.BackgroundTransparency = 1
    tabFrame.BorderSizePixel = 0
    tabFrame.Size = UDim2_new(0, 324, 0, 238)
    tabFrame.ScrollBarThickness = 0
    tabFrame.Visible = false

    if library.currentTab == nil then
        library.currentTab = {tabFrame, tabButton}
        glow.Transparency = 0
        tabFrame.Visible = true
    end

    tabPadding.Name = "TabPadding"
    tabPadding.Parent = tabFrame
    tabPadding.PaddingTop = UDim_new(0, 6)

    tabLayout.Name = "TabLayout"
    tabLayout.Parent = tabFrame
    tabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    tabLayout.SortOrder = Enum.SortOrder.LayoutOrder
    tabLayout.Padding = UDim_new(0, 5)

    tabLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        tabFrame.CanvasSize = UDim2_new(0, 0, 0, tabLayout.AbsoluteContentSize.Y + 12)
    end)

    tabButton.MouseButton1Click:Connect(function()
        Utils:SwitchTab({tabFrame, tabButton})
    end)

    local tab = {}

    function tab:NewSeparator()
        local separator = Instance_new("Frame")
        separator.Transparency = 1
        separator.Size = UDim2_new(0, 0, 0, 0)
        separator.BorderSizePixel = 0
        separator.Parent = tabFrame
    end

    function tab:NewButton(text, callback)
        callback = callback or noop
        local button = Instance_new("TextButton")
        local corner = Instance_new("UICorner")

        button.Name = "BtnModule"
        button.Parent = tabFrame
        button.BackgroundColor3 = Color3_fromRGB(52, 62, 72)
        button.BorderSizePixel = 0
        button.Size = UDim2_new(0, 312, 0, 28)
        button.AutoButtonColor = false
        button.Font = Enum.Font.GothamSemibold
        button.Text = "  " .. text
        button.TextColor3 = Color3_fromRGB(255, 255, 255)
        button.TextSize = 14
        button.TextXAlignment = Enum.TextXAlignment.Left

        corner.CornerRadius = UDim_new(0, 6)
        corner.Name = "BtnModuleCorner"
        corner.Parent = button

        button.MouseButton1Click:Connect(callback)
    end

    function tab:NewToggle(text, flagName, defaultValue, callback)
        callback = callback or noop
        defaultValue = defaultValue or false
        print(defaultValue)

        local toggleButton = Instance_new("TextButton")
        local corner = Instance_new("UICorner")
        local offStatus = Instance_new("Frame")
        local offGradient = Instance_new("UIGradient")
        local offCorner = Instance_new("UICorner")
        local onStatus = Instance_new("Frame")
        local onCorner = Instance_new("UICorner")
        local onGradient = Instance_new("UIGradient")

        library.flags[flagName or text] = {
            State = false,
            Callback = callback,
            SetState = function(self, newState)
                newState = (newState ~= nil) and newState or not library.flags:GetState(flagName)
                library.flags[flagName].State = newState
                task.spawn(function()
                    library.flags[flagName].Callback(newState)
                end)
                Utils:Tween({Transparency = newState and 1 or 0}, offStatus):Play()
                Utils:Tween({Transparency = newState and 0 or 1}, onStatus):Play()
            end
        }

        toggleButton.Name = "ToggleModule"
        toggleButton.Parent = tabFrame
        toggleButton.BackgroundColor3 = Color3_fromRGB(52, 62, 72)
        toggleButton.BorderSizePixel = 0
        toggleButton.Size = UDim2_new(0, 312, 0, 28)
        toggleButton.AutoButtonColor = false
        toggleButton.Font = Enum.Font.GothamSemibold
        toggleButton.Text = "  " .. text
        toggleButton.TextColor3 = Color3_fromRGB(255, 255, 255)
        toggleButton.TextSize = 14
        toggleButton.TextXAlignment = Enum.TextXAlignment.Left

        corner.CornerRadius = UDim_new(0, 6)
        corner.Name = "ToggleModuleCorner"
        corner.Parent = toggleButton

        offStatus.Name = "OffStatus"
        offStatus.Parent = toggleButton
        offStatus.BackgroundColor3 = Color3_fromRGB(255, 255, 255)
        offStatus.BorderSizePixel = 0
        offStatus.Position = UDim2_new(0.878205061, 0, 0.178571433, 0)
        offStatus.Size = UDim2_new(0, 34, 0, 18)

        offGradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0.00, Color3_fromRGB(255, 83, 83)),
            ColorSequenceKeypoint.new(0.15, Color3_fromRGB(255, 83, 83)),
            ColorSequenceKeypoint.new(0.62, Color3_fromRGB(52, 62, 72)),
            ColorSequenceKeypoint.new(1.00, Color3_fromRGB(52, 62, 72))
        })
        offGradient.Rotation = 300
        offGradient.Name = "OffGrad"
        offGradient.Parent = offStatus

        offCorner.CornerRadius = UDim_new(0, 4)
        offCorner.Name = "OffStatusCorner"
        offCorner.Parent = offStatus

        onStatus.Name = "OnStatus"
        onStatus.Parent = toggleButton
        onStatus.BackgroundColor3 = Color3_fromRGB(255, 255, 255)
        onStatus.BackgroundTransparency = 1
        onStatus.BorderSizePixel = 0
        onStatus.Position = UDim2_new(0.878205121, 0, 0.178571433, 0)
        onStatus.Size = UDim2_new(0, 34, 0, 18)
        onStatus.Transparency = 1

        onCorner.CornerRadius = UDim_new(0, 4)
        onCorner.Name = "OnStatusCorner"
        onCorner.Parent = onStatus

        onGradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0.00, Color3_fromRGB(52, 62, 72)),
            ColorSequenceKeypoint.new(0.38, Color3_fromRGB(48, 57, 67)),
            ColorSequenceKeypoint.new(1.00, Color3_fromRGB(53, 255, 134))
        })
        onGradient.Rotation = 300
        onGradient.Name = "OnGrad"
        onGradient.Parent = onStatus

        toggleButton.MouseButton1Click:Connect(function()
            library.flags[flagName or text]:SetState()
        end)

        if defaultValue then
            library.flags[flagName or text]:SetState(defaultValue)
        end
    end

    function tab:NewBind(text, defaultKey, callback)
        local key = Enum.KeyCode[defaultKey]
        local specialKeys = {
            Return = true,
            Space = true,
            Tab = true,
            Backquote = true,
            CapsLock = true,
            Escape = true,
            Unknown = true
        }
        local keyNames = {
            RightControl = "Right Ctrl",
            LeftControl = "Left Ctrl",
            LeftShift = "Left Shift",
            RightShift = "Right Shift",
            Semicolon = ";",
            Quote = '"',
            LeftBracket = "[",
            RightBracket = "]",
            Equals = "=",
            Minus = "-",
            RightAlt = "Right Alt",
            LeftAlt = "Left Alt"
        }

        local currentKey = key
        local currentKeyText = key and (keyNames[key.Name] or key.Name) or "None"

        local module = Instance_new("TextButton")
        local moduleCorner = Instance_new("UICorner")
        local valueButton = Instance_new("TextButton")
        local valueCorner = Instance_new("UICorner")

        module.Name = "KeybindModule"
        module.Parent = tabFrame
        module.BackgroundColor3 = Color3_fromRGB(52, 62, 72)
        module.BorderSizePixel = 0
        module.Size = UDim2_new(0, 312, 0, 28)
        module.AutoButtonColor = false
        module.Font = Enum.Font.GothamSemibold
        module.Text = "  " .. text
        module.TextColor3 = Color3_fromRGB(255, 255, 255)
        module.TextSize = 14
        module.TextXAlignment = Enum.TextXAlignment.Left

        moduleCorner.CornerRadius = UDim_new(0, 6)
        moduleCorner.Name = "KeybindModuleCorner"
        moduleCorner.Parent = module

        valueButton.Name = "KeybindValue"
        valueButton.Parent = module
        valueButton.BackgroundColor3 = Color3_fromRGB(58, 69, 80)
        valueButton.BorderSizePixel = 0
        valueButton.Position = UDim2_new(0.75, 0, 0.178571433, 0)
        valueButton.Size = UDim2_new(0, 74, 0, 18)
        valueButton.AutoButtonColor = false
        valueButton.Font = Enum.Font.Gotham
        valueButton.Text = currentKeyText
        valueButton.TextColor3 = Color3_fromRGB(255, 255, 255)
        valueButton.TextSize = 12

        valueCorner.CornerRadius = UDim_new(0, 4)
        valueCorner.Name = "KeybindValueCorner"
        valueCorner.Parent = valueButton

        Services.UserInputService.InputBegan:Connect(function(input, gameProcessed)
            if gameProcessed then return end
            if input.UserInputType ~= Enum.UserInputType.Keyboard then return end
            if input.KeyCode ~= currentKey then return end
            callback(currentKey.Name)
        end)

        valueButton.MouseButton1Click:Connect(function()
            valueButton.Text = "..."
            wait()
            local newInput, _ = Services.UserInputService.InputEnded:Wait()
            local keyName = tostring(newInput.KeyCode.Name)
            if newInput.UserInputType ~= Enum.UserInputType.Keyboard then
                valueButton.Text = currentKeyText
                return
            end
            if specialKeys[keyName] then
                valueButton.Text = currentKeyText
                return
            end
            wait()
            currentKey = Enum.KeyCode[keyName]
            valueButton.Text = keyNames[keyName] or keyName
        end)
    end

    function tab:NewSlider(text, flagName, defaultValue, minValue, maxValue, float, callback)
        defaultValue = defaultValue or minValue
        callback = callback or noop

        local module = Instance_new("TextButton")
        local moduleCorner = Instance_new("UICorner")
        local sliderBar = Instance_new("Frame")
        local sliderBarCorner = Instance_new("UICorner")
        local sliderPart = Instance_new("Frame")
        local sliderPartCorner = Instance_new("UICorner")
        local valueBox = Instance_new("TextBox")
        local valueBoxCorner = Instance_new("UICorner")
        local addButton = Instance_new("TextButton")
        local minusButton = Instance_new("TextButton")

        library.flags[flagName] = {
            State = defaultValue,
            SetValue = function(self, newValue)
                local percent = (Mouse.X - sliderBar.AbsolutePosition.X) / sliderBar.AbsoluteSize.X
                if newValue then
                    percent = (newValue - minValue) / (maxValue - minValue)
                end
                percent = math.clamp(percent, 0, 1)
                if float then
                    newValue = newValue or tonumber(string.format("%.1f", tostring(minValue + (maxValue - minValue) * percent)))
                else
                    newValue = newValue or math.floor(minValue + (maxValue - minValue) * percent)
                end
                library.flags[flagName].State = tonumber(newValue)
                valueBox.Text = tostring(newValue)
                sliderPart.Size = UDim2_new(percent, 0, 1, 0)
                callback(tonumber(newValue))
            end
        }

        module.Name = "SliderModule"
        module.Parent = tabFrame
        module.BackgroundColor3 = Color3_fromRGB(52, 62, 72)
        module.BorderSizePixel = 0
        module.Position = UDim2_new(0, 0, -0.140425533, 0)
        module.Size = UDim2_new(0, 312, 0, 28)
        module.AutoButtonColor = false
        module.Font = Enum.Font.GothamSemibold
        module.Text = "  " .. text
        module.TextColor3 = Color3_fromRGB(255, 255, 255)
        module.TextSize = 14
        module.TextXAlignment = Enum.TextXAlignment.Left

        moduleCorner.CornerRadius = UDim_new(0, 6)
        moduleCorner.Name = "SliderModuleCorner"
        moduleCorner.Parent = module

        sliderBar.Name = "SliderBar"
        sliderBar.Parent = module
        sliderBar.BackgroundColor3 = Color3_fromRGB(58, 69, 80)
        sliderBar.BorderSizePixel = 0
        sliderBar.Position = UDim2_new(0.442307681, 0, 0.392857134, 0)
        sliderBar.Size = UDim2_new(0, 108, 0, 6)

        sliderBarCorner.CornerRadius = UDim_new(0, 2)
        sliderBarCorner.Name = "SliderBarCorner"
        sliderBarCorner.Parent = sliderBar

        sliderPart.Name = "SliderPart"
        sliderPart.Parent = sliderBar
        sliderPart.BackgroundColor3 = Color3_fromRGB(255, 255, 255)
        sliderPart.BorderSizePixel = 0
        sliderPart.Size = UDim2_new(0, 0, 0, 6)

        sliderPartCorner.CornerRadius = UDim_new(0, 2)
        sliderPartCorner.Name = "SliderPartCorner"
        sliderPartCorner.Parent = sliderPart

        valueBox.Name = "SliderValue"
        valueBox.Parent = module
        valueBox.BackgroundColor3 = Color3_fromRGB(58, 69, 80)
        valueBox.BorderSizePixel = 0
        valueBox.Position = UDim2_new(0.884615362, 0, 0.178571433, 0)
        valueBox.Size = UDim2_new(0, 32, 0, 18)
        valueBox.Font = Enum.Font.Gotham
        valueBox.Text = tostring(defaultValue or minValue)
        valueBox.TextColor3 = Color3_fromRGB(255, 255, 255)
        valueBox.TextSize = 12

        valueBoxCorner.CornerRadius = UDim_new(0, 4)
        valueBoxCorner.Name = "SliderValueCorner"
        valueBoxCorner.Parent = valueBox

        addButton.Name = "AddSlider"
        addButton.Parent = module
        addButton.BackgroundColor3 = Color3_fromRGB(255, 255, 255)
        addButton.BackgroundTransparency = 1
        addButton.BorderSizePixel = 0
        addButton.Position = UDim2_new(0.807692289, 0, 0.178571433, 0)
        addButton.Size = UDim2_new(0, 18, 0, 18)
        addButton.Font = Enum.Font.Gotham
        addButton.Text = "+"
        addButton.TextColor3 = Color3_fromRGB(255, 255, 255)
        addButton.TextSize = 18

        minusButton.Name = "MinusSlider"
        minusButton.Parent = module
        minusButton.BackgroundColor3 = Color3_fromRGB(255, 255, 255)
        minusButton.BackgroundTransparency = 1
        minusButton.BorderSizePixel = 0
        minusButton.Position = UDim2_new(0.365384609, 0, 0.178571433, 0)
        minusButton.Size = UDim2_new(0, 18, 0, 18)
        minusButton.Font = Enum.Font.Gotham
        minusButton.Text = "-"
        minusButton.TextColor3 = Color3_fromRGB(255, 255, 255)
        minusButton.TextSize = 18

        minusButton.MouseButton1Click:Connect(function()
            local current = library.flags:GetState(flagName)
            current = math.clamp(current - 1, minValue, maxValue)
            library.flags[flagName]:SetValue(current)
        end)

        addButton.MouseButton1Click:Connect(function()
            local current = library.flags:GetState(flagName)
            current = math.clamp(current + 1, minValue, maxValue)
            library.flags[flagName]:SetValue(current)
        end)

        library.flags[flagName]:SetValue(defaultValue)

        local dragging = false
        local focused = false
        local ignoreText = {[""] = true, ["-"] = true}

        sliderBar.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                library.flags[flagName]:SetValue()
                dragging = true
            end
        end)

        Services.UserInputService.InputEnded:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)

        Services.UserInputService.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                library.flags[flagName]:SetValue()
            end
        end)

        valueBox.Focused:Connect(function()
            focused = true
        end)

        valueBox.FocusLost:Connect(function()
            focused = false
            if valueBox.Text == "" then
                library.flags[flagName]:SetValue(defaultValue)
            end
        end)

        valueBox:GetPropertyChangedSignal("Text"):Connect(function()
            if not focused then return end
            valueBox.Text = valueBox.Text:gsub("%D+", "")
            local newText = valueBox.Text
            if not tonumber(newText) then
                valueBox.Text = valueBox.Text:gsub("%D+", "")
            elseif not ignoreText[newText] then
                if tonumber(newText) > maxValue then
                    newText = maxValue
                    valueBox.Text = tostring(maxValue)
                end
                library.flags[flagName]:SetValue(tonumber(newText))
            end
        end)
    end

    function tab:NewDropdown(text, flagName, options, callback)
        callback = callback or noop
        library.flags[flagName] = { State = options[1] }

        local module = Instance_new("TextButton")
        local moduleCorner = Instance_new("UICorner")
        local textBox = Instance_new("TextBox")
        local openButton = Instance_new("TextButton")
        local bottomPanel = Instance_new("TextButton")
        local bottomCorner = Instance_new("UICorner")
        local bottomLayout = Instance_new("UIListLayout")
        local bottomPadding = Instance_new("UIPadding")

        module.Name = "DropdownModule"
        module.Parent = tabFrame
        module.BackgroundColor3 = Color3_fromRGB(52, 62, 72)
        module.BorderSizePixel = 0
        module.Size = UDim2_new(0, 312, 0, 28)
        module.AutoButtonColor = false
        module.Font = Enum.Font.GothamSemibold
        module.Text = ""
        module.TextColor3 = Color3_fromRGB(255, 255, 255)
        module.TextSize = 14
        module.TextXAlignment = Enum.TextXAlignment.Left

        moduleCorner.CornerRadius = UDim_new(0, 6)
        moduleCorner.Name = "DropdownModuleCorner"
        moduleCorner.Parent = module

        textBox.Name = "DropdownText"
        textBox.Parent = module
        textBox.BackgroundColor3 = Color3_fromRGB(255, 255, 255)
        textBox.BackgroundTransparency = 1
        textBox.Position = UDim2_new(0.025641026, 0, 0, 0)
        textBox.Size = UDim2_new(0, 192, 0, 28)
        textBox.Font = Enum.Font.GothamSemibold
        textBox.PlaceholderText = text
        textBox.PlaceholderColor3 = Color3_fromRGB(255, 255, 255)
        textBox.TextColor3 = Color3_fromRGB(255, 255, 255)
        textBox.TextSize = 14
        textBox.TextXAlignment = Enum.TextXAlignment.Left
        textBox.Text = ""

        openButton.Name = "OpenDropdown"
        openButton.Parent = module
        openButton.BackgroundColor3 = Color3_fromRGB(255, 255, 255)
        openButton.BackgroundTransparency = 1
        openButton.BorderSizePixel = 0
        openButton.Position = UDim2_new(0.907051265, 0, 0.178571433, 0)
        openButton.Size = UDim2_new(0, 18, 0, 18)
        openButton.Font = Enum.Font.Gotham
        openButton.Text = "+"
        openButton.TextColor3 = Color3_fromRGB(255, 255, 255)
        openButton.TextSize = 22

        bottomPanel.Name = "DropdownBottom"
        bottomPanel.Parent = tabFrame
        bottomPanel.BackgroundColor3 = Color3_fromRGB(52, 62, 72)
        bottomPanel.BorderSizePixel = 0
        bottomPanel.ClipsDescendants = true
        bottomPanel.Position = UDim2_new(0.0185185187, 0, 0.206896558, 0)
        bottomPanel.Size = UDim2_new(0, 312, 0, 0)
        bottomPanel.AutoButtonColor = false
        bottomPanel.Font = Enum.Font.GothamSemibold
        bottomPanel.Text = ""
        bottomPanel.TextColor3 = Color3_fromRGB(255, 255, 255)
        bottomPanel.TextSize = 14
        bottomPanel.TextXAlignment = Enum.TextXAlignment.Left
        bottomPanel.Visible = false

        bottomCorner.CornerRadius = UDim_new(0, 6)
        bottomCorner.Name = "DropdownBottomCorner"
        bottomCorner.Parent = bottomPanel

        bottomLayout.Name = "DropdownBottomLayout"
        bottomLayout.Parent = bottomPanel
        bottomLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
        bottomLayout.SortOrder = Enum.SortOrder.LayoutOrder
        bottomLayout.Padding = UDim_new(0, 6)

        bottomPadding.Name = "DropdownBottomPadding"
        bottomPadding.Parent = bottomPanel
        bottomPadding.PaddingTop = UDim_new(0, 6)

        local open = false
        local function showAllOptions()
            local children = bottomPanel:GetChildren()
            for _, child in ipairs(children) do
                if child:IsA("TextButton") then
                    child.Visible = true
                end
            end
        end

        local function filterOptions(filterText)
            local children = bottomPanel:GetChildren()
            for _, child in ipairs(children) do
                if filterText == "" then
                    showAllOptions()
                else
                    if child:IsA("TextButton") then
                        if child.Name:lower():sub(1, string.len(filterText)) == filterText:lower() then
                            child.Visible = true
                        else
                            child.Visible = false
                        end
                    end
                end
            end
        end

        local function toggleDropdown()
            open = not open
            if open then
                bottomPanel.Visible = true
                showAllOptions()
            else
                task.spawn(function()
                    task.wait(0.35)
                    bottomPanel.Visible = false
                end)
            end
            openButton.Text = open and "-" or "+"
            Utils:Tween({Size = UDim2_new(0, 312, 0, open and bottomLayout.AbsoluteContentSize.Y + 12 or 0)}, bottomPanel, 0.35):Play()
        end

        openButton.MouseButton1Click:Connect(toggleDropdown)

        textBox.Focused:Connect(function()
            if open then return end
            toggleDropdown()
        end)

        textBox:GetPropertyChangedSignal("Text"):Connect(function()
            filterOptions(textBox.Text)
        end)

        library.flags[flagName].SetOptions = function(self, newOptions)
            library.flags[flagName]:ClearOptions()
            for _, option in ipairs(newOptions) do
                library.flags[flagName]:AddOption(option)
            end
        end

        library.flags[flagName].ClearOptions = function(self)
            local children = bottomPanel:GetChildren()
            for _, child in ipairs(children) do
                if child:IsA("TextButton") then
                    child:Destroy()
                end
            end
        end

        library.flags[flagName].AddOption = function(self, optionName)
            local optionButton = Instance_new("TextButton")
            local optionCorner = Instance_new("UICorner")
            optionButton.Name = optionName
            optionButton.Parent = bottomPanel
            optionButton.BackgroundColor3 = Color3_fromRGB(58, 69, 80)
            optionButton.BorderSizePixel = 0
            optionButton.Size = UDim2_new(0, 300, 0, 28)
            optionButton.AutoButtonColor = false
            optionButton.Font = Enum.Font.GothamSemibold
            optionButton.Text = optionName
            optionButton.TextColor3 = Color3_fromRGB(255, 255, 255)
            optionButton.TextSize = 14
            optionCorner.CornerRadius = UDim_new(0, 6)
            optionCorner.Name = "OptionCorner"
            optionCorner.Parent = optionButton
            optionButton.MouseButton1Click:Connect(function()
                textBox.PlaceholderText = optionName
                textBox.Text = ""
                library.flags[flagName].State = optionName
                task.spawn(toggleDropdown)
                callback(optionName)
            end)
        end

        library.flags[flagName].RemoveOption = function(self, optionName)
            bottomPanel:WaitForChild(optionName):Destroy()
        end

        library.flags[flagName]:SetOptions(options)
    end

    return tab
end

setmetatable(getgenv().library, {
    __newindex = function(self, index, value)
        if index == 'Name' then
            TitleLabel.Text = "   " .. value
            return true
        end
        rawset(self, index, value)
    end
})
